<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<title>Test Cricket Side by Side</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* Password Gate Styles */
.password-overlay{position:fixed;inset:0;background:linear-gradient(135deg,#1a1e26 0%,#2d3340 100%);z-index:99999;display:flex;align-items:center;justify-content:center;opacity:1;transition:opacity 0.4s}
.password-overlay.hidden{opacity:0;pointer-events:none}
.password-box{background:#fff;border-radius:16px;padding:40px 48px;text-align:center;box-shadow:0 25px 80px rgba(0,0,0,0.4);max-width:400px;width:90%}
.password-box h2{font-family:'DM Serif Display',serif;font-size:24px;color:#1a1e26;margin-bottom:8px}
.password-box p{font-size:13px;color:#5a6578;margin-bottom:24px}
.input-group{position:relative;margin-bottom:12px;text-align:left}
.input-group input{width:100%;padding:12px 16px;border:2px solid #d8dce3;border-radius:8px;font-size:14px;font-family:'Outfit',sans-serif;outline:none;transition:border-color 0.2s}
.input-group input[type="password"],.input-group input[type="text"]:not([type="email"]){padding-right:44px}
.input-group input:focus{border-color:#c08018}
.input-group input.error{border-color:#d04040;animation:shake 0.4s}
.toggle-pw{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:#8896a8;padding:4px}
.toggle-pw:hover{color:#5a6578}
.toggle-pw svg{width:20px;height:20px}
.password-box button.submit-btn{width:100%;margin-top:8px;padding:12px;background:linear-gradient(135deg,#c08018,#8a5810);color:#fff;border:none;border-radius:8px;font-size:14px;font-weight:600;font-family:'Outfit',sans-serif;cursor:pointer;transition:transform 0.2s,box-shadow 0.2s}
.password-box button.submit-btn:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(192,128,24,0.35)}
.password-box button.submit-btn:disabled{opacity:0.6;cursor:not-allowed;transform:none}
.password-error{color:#d04040;font-size:12px;margin-top:10px;opacity:0;transition:opacity 0.2s}
.password-error.show{opacity:1}
@keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-8px)}40%,80%{transform:translateX(8px)}}
.site-content{display:none}
.site-content.unlocked{display:block}

*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
:root{
  --bg:#f4f5f7;--surface:#ffffff;--surface2:#f0f1f4;--surface3:#e8eaef;
  --border:#d8dce3;--border2:#c8cdd6;
  --text:#1a1e26;--text2:#5a6578;--text3:#8896a8;
  --accent:#c08018;--accent-dim:rgba(192,128,24,0.10);--accent-glow:rgba(192,128,24,0.06);
  --green:#1a9a60;--green-dim:rgba(26,154,96,0.10);
  --red:#d04040;
  --p1:#c08018;--p2:#1a9a60;--p3:#2870d0;--p4:#c04060;--p5:#8050d0;
}
body{background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;min-height:100vh;overflow-x:hidden;-webkit-tap-highlight-color:rgba(0,0,0,0.1);touch-action:manipulation}

/* Header */
.header{
  padding:22px 32px 16px;position:relative;
  background:linear-gradient(180deg,#eaecf0 0%,var(--bg) 100%);
  border-bottom:1px solid var(--border);
}
.header::after{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 25% -20%,var(--accent-glow),transparent 60%);pointer-events:none}
.hdr-inner{max-width:1440px;margin:0 auto;position:relative;display:flex;justify-content:space-between;align-items:center}
.brand{display:flex;align-items:center;gap:12px}
.brand-icon{
  width:36px;height:36px;border-radius:8px;
  background:linear-gradient(135deg,var(--accent),#8a5810);
  display:flex;align-items:center;justify-content:center;
  font-size:14px;font-weight:800;color:#fff;letter-spacing:-0.5px;
  box-shadow:0 3px 14px rgba(192,128,24,0.30);
}
.brand h1{font-family:'DM Serif Display',serif;font-size:21px;letter-spacing:-0.3px}
.brand-sub{font-size:11.5px;color:var(--text3);margin-top:2px;margin-left:48px}

.share-btn{
  background:var(--surface);border:1px solid var(--border);border-radius:8px;
  padding:8px 16px;cursor:pointer;display:flex;align-items:center;gap:8px;
  font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;
  color:var(--text2);transition:all 0.2s;z-index:10;position:relative;
}
.share-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}
.share-btn svg{width:16px;height:16px;stroke:currentColor;fill:none}

.hdr-nav{display:flex;align-items:center;gap:8px}
.nav-link{
  background:var(--surface);border:1px solid var(--border);border-radius:8px;
  padding:8px 16px;cursor:pointer;display:flex;align-items:center;gap:7px;
  font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;
  color:var(--text2);transition:all 0.2s;text-decoration:none;
}
.nav-link:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}
.nav-link.active{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}
.nav-link svg{width:15px;height:15px;stroke:currentColor;fill:none;flex-shrink:0}

.main{max-width:1440px;margin:0 auto;padding:20px 32px 60px}

/* Player Selection */
.sel-area{display:flex;flex-wrap:wrap;gap:12px;align-items:start;margin-bottom:18px}
.sel-card{
  background:var(--surface);border:1px solid var(--border);border-radius:11px;
  padding:14px 16px;position:relative;transition:border-color 0.25s;
  flex:1 1 200px;min-width:200px;max-width:340px;
}
.sel-card:focus-within{border-color:rgba(192,128,24,0.45)}
.sel-card.active-1{border-color:var(--p1)}
.sel-card.active-2{border-color:var(--p2)}
.sel-card.active-3{border-color:var(--p3)}
.sel-card.active-4{border-color:var(--p4)}
.sel-card.active-5{border-color:var(--p5)}
.sel-label{font-size:10px;font-weight:700;letter-spacing:1.8px;text-transform:uppercase;color:var(--text3);margin-bottom:8px}
.sel-input{
  width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:6px;
  padding:8px 11px;color:var(--text);font-family:'Outfit',sans-serif;font-size:13px;
  outline:none;transition:all 0.2s;
}
.sel-input:focus{border-color:var(--accent);background:var(--surface3)}
.sel-input::placeholder{color:var(--text3)}
.sel-clear{
  position:absolute;top:14px;right:16px;background:none;border:none;
  color:var(--text3);cursor:pointer;font-size:16px;display:none;line-height:1;
}
.sel-clear:hover{color:var(--red)}
.sel-clear.show{display:block}
.dd{
  position:absolute;left:16px;right:16px;top:72px;z-index:100;
  background:var(--surface2);border:1px solid var(--border2);border-radius:8px;
  max-height:250px;overflow-y:auto;box-shadow:0 14px 44px rgba(0,0,0,0.12);display:none;
}
.dd.open{display:block}
.dd-item{
  padding:8px 12px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;
  font-size:12.5px;border-bottom:1px solid rgba(200,205,214,0.6);transition:background 0.12s;
}
.dd-item:last-child{border:none}
.dd-item:hover{background:var(--surface3)}
.dd-item .nm{font-weight:500}
.dd-item .ct{font-size:10px;color:var(--text3);background:var(--surface);padding:2px 7px;border-radius:4px}
.dd-item .yr{font-size:10.5px;color:var(--text3);margin-left:6px}

.sel-info{margin-top:10px;display:none}
.sel-info.show{display:block}
.si-name{font-family:'DM Serif Display',serif;font-size:18px;margin-bottom:2px}
.si-meta{font-size:11.5px;color:var(--text2)}
.ctry-badge{
  display:inline-block;padding:1px 8px;border-radius:3px;
  font-size:10px;font-weight:700;letter-spacing:0.3px;margin-right:6px;
}

.vs{display:none}

.add-player-btn{
  flex:0 0 auto;align-self:stretch;min-width:120px;max-width:200px;
  background:var(--surface);border:1.5px dashed var(--border2);border-radius:11px;
  padding:14px 16px;cursor:pointer;transition:all 0.25s;
  display:flex;align-items:center;justify-content:center;gap:8px;
  font-family:'Outfit',sans-serif;font-size:12px;font-weight:600;color:var(--text3);
}
.add-player-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}
.add-player-btn .plus{font-size:20px;line-height:1}
.sel-card .sel-pcolor{
  position:absolute;top:14px;left:16px;width:8px;height:8px;border-radius:50%;
  box-shadow:0 0 6px currentColor;
}

/* Filters */
.filters-panel{
  background:var(--surface);border:1px solid var(--border);border-radius:11px;
  padding:14px 16px;margin-bottom:18px;display:none;
}
.filters-panel.show{display:block}
.fp-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.fp-title{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3)}
.fp-reset{
  font-size:11px;color:var(--accent);background:none;border:none;cursor:pointer;
  font-family:'Outfit',sans-serif;font-weight:600;
}
.fp-reset:hover{text-decoration:underline}
.fp-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(185px,1fr));gap:10px}
.fp-group label{font-size:10.5px;font-weight:600;color:var(--text2);display:block;margin-bottom:4px}
.fp-select{
  width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:5px;
  padding:6px 10px;color:var(--text);font-family:'Outfit',sans-serif;font-size:12px;
  outline:none;cursor:pointer;appearance:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%235a6578'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:right 10px center;
}
.fp-select:focus{border-color:var(--accent)}

/* Multi-select opponent dropdown */
.ms-wrap{position:relative}
.ms-toggle{
  width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:5px;
  padding:6px 28px 6px 10px;color:var(--text);font-family:'Outfit',sans-serif;font-size:12px;
  outline:none;cursor:pointer;text-align:left;min-height:30px;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%235a6578'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:right 10px center;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.ms-toggle:focus,.ms-toggle.open{border-color:var(--accent)}
.ms-toggle .ms-placeholder{color:var(--text3)}
.ms-dd{
  position:absolute;left:0;right:0;top:100%;z-index:50;margin-top:3px;
  background:var(--surface);border:1px solid var(--border2);border-radius:6px;
  max-height:220px;overflow-y:auto;box-shadow:0 10px 36px rgba(0,0,0,0.13);display:none;
}
.ms-dd.open{display:block}
.ms-dd-item{
  padding:6px 10px;cursor:pointer;display:flex;align-items:center;gap:8px;
  font-size:12px;border-bottom:1px solid rgba(200,205,214,0.4);transition:background 0.12s;
}
.ms-dd-item:last-child{border:none}
.ms-dd-item:hover{background:var(--surface2)}
.ms-dd-item .ms-cb{
  width:14px;height:14px;border-radius:3px;border:1.5px solid var(--border2);
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
  transition:all 0.15s;
}
.ms-dd-item.checked .ms-cb{background:var(--accent);border-color:var(--accent)}
.ms-dd-item.checked .ms-cb::after{content:'‚úì';color:#fff;font-size:10px;font-weight:700}
.ms-dd-item .ms-lbl{flex:1;font-weight:500}
.active-filters{display:flex;flex-wrap:wrap;gap:5px;margin-top:10px}
.af-tag{
  display:inline-flex;align-items:center;gap:4px;padding:2px 9px;
  background:var(--accent-dim);border:1px solid rgba(192,128,24,0.25);
  border-radius:5px;font-size:10.5px;color:var(--accent);font-weight:500;
}
.af-tag button{background:none;border:none;color:var(--accent);cursor:pointer;font-size:12px;line-height:1}

/* Comparison */
.comp{display:none}
.comp.show{display:block}
.empty{text-align:center;padding:70px 20px}
.empty-ico{font-size:42px;margin-bottom:14px;opacity:0.25}
.empty h2{font-family:'DM Serif Display',serif;font-size:21px;color:var(--text2);margin-bottom:6px}
.empty p{font-size:13px;color:var(--text3);max-width:380px;margin:0 auto}

/* Tabs */
.tabs{display:flex;gap:3px;margin-bottom:18px;background:var(--surface);border-radius:8px;padding:3px;border:1px solid var(--border)}
.tab{
  flex:1;padding:8px;border-radius:6px;border:none;background:none;
  color:var(--text2);font-family:'Outfit',sans-serif;font-size:12px;
  font-weight:500;cursor:pointer;transition:all 0.2s;
}
.tab:hover{color:var(--text)}
.tab.on{background:var(--surface3);color:var(--accent);font-weight:600}
.tc{display:none}
.tc.on{display:block}

/* ---- TRANSPOSED TABLE: players = rows, stats = columns ---- */
.tbl-wrap{overflow-x:auto;margin-bottom:24px;border-radius:11px;border:1px solid var(--border)}
.cmp-table{
  width:100%;border-collapse:separate;border-spacing:0;
  background:var(--surface);min-width:600px;
}

/* Column headers = stat names */
.cmp-table thead th{
  padding:10px 12px;font-size:10px;font-weight:700;letter-spacing:0.8px;
  text-transform:uppercase;color:var(--text3);text-align:center;
  border-bottom:2px solid var(--border2);background:var(--surface2);
  position:sticky;top:0;z-index:2;white-space:nowrap;
}
.cmp-table thead th:first-child{
  text-align:left;position:sticky;left:0;z-index:3;
  background:var(--surface2);min-width:160px;
  font-size:10px;letter-spacing:1.2px;
}

/* Section header columns */
.cmp-table thead th.sec-head{
  color:var(--accent);font-family:'DM Serif Display',serif;
  font-size:11px;letter-spacing:0.3px;text-transform:none;
  border-left:2px solid var(--border2);
}

/* Player rows */
.cmp-table tbody td{
  padding:10px 12px;font-size:13.5px;font-weight:600;
  text-align:center;font-variant-numeric:tabular-nums;
  border-bottom:1px solid var(--border);
  transition:background 0.1s;
}
.cmp-table tbody tr:last-child td{border-bottom:none}
.cmp-table tbody tr:hover td{background:rgba(0,0,0,0.025)}

/* Player name cell (first column, sticky) */
.cmp-table tbody td.player-cell{
  text-align:left;position:sticky;left:0;z-index:1;
  background:var(--surface);font-weight:700;white-space:nowrap;
  border-right:1px solid var(--border);
}
.cmp-table tbody tr:hover td.player-cell{background:var(--surface2)}
.pc-name{font-family:'DM Serif Display',serif;font-size:15px;display:block;margin-bottom:1px}
.pc-meta{font-size:10px;font-weight:400;color:var(--text3);display:block}

/* Colored player row accents */
.cmp-table tbody tr.p1-row td.player-cell{border-left:3px solid var(--p1)}
.cmp-table tbody tr.p2-row td.player-cell{border-left:3px solid var(--p2)}
.cmp-table tbody tr.p3-row td.player-cell{border-left:3px solid var(--p3)}
.cmp-table tbody tr.p4-row td.player-cell{border-left:3px solid var(--p4)}
.cmp-table tbody tr.p5-row td.player-cell{border-left:3px solid var(--p5)}

/* Cell value highlighting */
.cmp-table tbody td.best{color:var(--green)}
.cmp-table tbody td.worse{color:var(--text3)}
.cmp-table tbody td.best::after{
  content:'';display:inline-block;width:4px;height:4px;border-radius:50%;
  background:var(--green);margin-left:6px;vertical-align:middle;
  box-shadow:0 0 5px rgba(26,154,96,0.4);
}

/* Section dividers in columns */
.cmp-table tbody td.sec-div{border-left:2px solid var(--border2)}

/* Verdict */
.verd{
  background:linear-gradient(135deg,var(--surface),var(--surface2));
  border:1px solid var(--border);border-radius:11px;padding:18px;
  margin-bottom:20px;text-align:center;
}
.verd-lb{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px}
.verd-tx{font-size:15px;line-height:1.6;color:var(--text)}

/* Filter summary */
.filt-sum{
  display:inline-flex;align-items:center;gap:6px;padding:4px 12px;
  background:var(--accent-dim);border-radius:6px;font-size:11px;
  color:var(--accent);margin-bottom:14px;font-weight:500;
}

.foot-note{font-size:10.5px;color:var(--text3);margin-top:-18px;margin-bottom:24px;padding-left:4px}

/* Scrollbar */
::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}

/* iPad/Tablet optimizations (768px - 1024px) */
@media(min-width:768px) and (max-width:1024px){
  .main{padding:20px 24px 60px}
  .header{padding:18px 24px 14px}
  
  /* Make player cards stack 2 per row on iPad */
  .sel-area{gap:10px}
  .sel-card{flex:1 1 calc(50% - 5px);min-width:280px;max-width:calc(50% - 5px)}
  .add-player-btn{flex:1 1 calc(50% - 5px);min-width:280px;max-width:calc(50% - 5px)}
  
  /* Optimize filter grid for iPad */
  .fp-grid{grid-template-columns:repeat(3,1fr);gap:8px}
  
  /* Table optimizations for iPad - make it scrollable horizontally */
  .tbl-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch}
  .cmp-table{min-width:800px}
  .cmp-table thead th{padding:9px 10px;font-size:10px}
  .cmp-table tbody td{padding:9px 10px;font-size:12px}
  .cmp-table tbody td.player-cell{min-width:140px}
  
  /* Improve touch targets for iPad */
  .sel-input{font-size:14px;padding:10px 12px}
  .dd-item{padding:10px 14px;font-size:13px}
  .fp-select{padding:8px 12px;font-size:13px}
  .ms-toggle{padding:8px 12px;font-size:13px;min-height:36px}
  .tab{padding:10px 18px;font-size:12.5px}
  
  /* Optimize dropdowns for touch */
  .dd{max-height:300px}
  .ms-dd{max-height:280px}
}

/* Mobile phones (max-width: 767px) */
@media(max-width:767px){
  .header{padding:14px 16px}
  .hdr-inner{flex-direction:column;align-items:flex-start;gap:10px}
  .hdr-nav{position:absolute;top:14px;right:16px}
  .nav-link span{display:none}
  .nav-link{padding:8px 10px}
  .share-btn{padding:8px 10px;font-size:0}
  .share-btn svg{margin:0}
  .share-btn span{display:none}
  .main{padding:12px 14px}
  .sel-area{flex-direction:column}
  .sel-card{max-width:100%}
  .add-player-btn{max-width:100%;min-height:50px}
  .fp-grid{grid-template-columns:1fr 1fr}
  .tbl-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch}
  .cmp-table{min-width:600px}
  .cmp-table thead th{padding:7px 8px;font-size:8.5px}
  .cmp-table tbody td{padding:7px 8px;font-size:11.5px}
  .cmp-table tbody td.player-cell{min-width:120px}
  .pc-name{font-size:13px}
}
</style>
</head>
<body>

<!-- Password Gate Overlay -->
<div class="password-overlay" id="passwordOverlay">
  <div class="password-box">
    <h2>üèè Cricket Stats</h2>
    <p>Enter your email and password to access</p>
    <div class="input-group">
      <input type="email" id="emailInput" placeholder="Email address">
    </div>
    <div class="input-group">
      <input type="password" id="passwordInput" placeholder="Password" onkeypress="if(event.key==='Enter')checkPassword()">
      <button class="toggle-pw" onclick="togglePassword()" type="button">
        <svg id="eyeIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
          <circle cx="12" cy="12" r="3"></circle>
        </svg>
      </button>
    </div>
    <button class="submit-btn" onclick="checkPassword()">Unlock</button>
    <div class="password-error" id="passwordError">Incorrect password. Try again.</div>
  </div>
</div>

<div class="site-content" id="siteContent">
<div class="header">
  <div class="hdr-inner">
    <div class="brand">
      <div class="brand-icon">CT</div>
      <h1>Test Cricket Comparisons</h1>
    </div>
    <div class="hdr-nav">
      <a href="country-results.html" class="nav-link">
        <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="2" y1="12" x2="22" y2="12"></line>
          <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
        </svg>
        <span>Countries</span>
      </a>
      <a href="batting-records.html" class="nav-link">
        <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="3" y1="9" x2="21" y2="9"></line>
          <line x1="3" y1="15" x2="21" y2="15"></line>
          <line x1="9" y1="3" x2="9" y2="21"></line>
        </svg>
        <span>Batting</span>
      </a>
      <a href="index.html" class="nav-link active">
        <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        <span>Compare</span>
      </a>
      <a href="simulation.html" class="nav-link">
        <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="2" width="20" height="20" rx="3"></rect>
          <circle cx="8" cy="8" r="1.5" fill="currentColor" stroke="none"></circle>
          <circle cx="16" cy="8" r="1.5" fill="currentColor" stroke="none"></circle>
          <circle cx="8" cy="16" r="1.5" fill="currentColor" stroke="none"></circle>
          <circle cx="16" cy="16" r="1.5" fill="currentColor" stroke="none"></circle>
          <circle cx="12" cy="12" r="1.5" fill="currentColor" stroke="none"></circle>
        </svg>
        <span>Simulation</span>
      </a>
      <button class="nav-link share-btn" onclick="shareComparison()">
        <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="18" cy="5" r="3"></circle>
          <circle cx="6" cy="12" r="3"></circle>
          <circle cx="18" cy="19" r="3"></circle>
          <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
          <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
        </svg>
        <span>Share</span>
      </button>
    </div>
  </div>
</div>
        <span>Share</span>
      </button>
    </div>
    <div class="brand-sub">3,253 players ¬∑ 1877‚Äì2025 ¬∑ All Test-playing nations ¬∑ Match-level filters</div>
  </div>
</div>

<div class="main">
  <div class="sel-area" id="selArea">
    <div class="sel-card" id="c1">
      <div class="sel-pcolor" style="color:var(--p1);background:var(--p1)"></div>
      <div class="sel-label" style="margin-left:18px">Player 1</div>
      <input class="sel-input" id="s1" placeholder="Search by name or country..." autocomplete="off">
      <button class="sel-clear" id="x1" onclick="clearP(1)">&times;</button>
      <div class="dd" id="d1"></div>
      <div class="sel-info" id="i1"><div class="si-name" id="n1"></div><div class="si-meta" id="m1"></div></div>
    </div>
    <div class="sel-card" id="c2">
      <div class="sel-pcolor" style="color:var(--p2);background:var(--p2)"></div>
      <div class="sel-label" style="margin-left:18px">Player 2</div>
      <input class="sel-input" id="s2" placeholder="Search by name or country..." autocomplete="off">
      <button class="sel-clear" id="x2" onclick="clearP(2)">&times;</button>
      <div class="dd" id="d2"></div>
      <div class="sel-info" id="i2"><div class="si-name" id="n2"></div><div class="si-meta" id="m2"></div></div>
    </div>
    <button class="add-player-btn" id="addPlayerBtn" onclick="addPlayerSlot()"><span class="plus">+</span> Add Player</button>
  </div>

  <div class="filters-panel" id="filtersPanel">
    <div class="fp-header">
      <span class="fp-title">Filters</span>
      <button class="fp-reset" onclick="resetFilters()">Reset all</button>
    </div>
    <div class="fp-grid">
      <div class="fp-group"><label>Opponent</label>
        <div class="ms-wrap" id="fOppWrap">
          <button class="ms-toggle" id="fOppToggle" type="button" onclick="toggleOppDD()"><span class="ms-placeholder">All opponents</span></button>
          <div class="ms-dd" id="fOppDD"></div>
        </div>
      </div>
      <div class="fp-group"><label>Home / Away</label><select class="fp-select" id="fHA" onchange="applyFilters()"><option value="">All</option><option value="home">Home</option><option value="away">Away</option><option value="neutral">Neutral</option></select></div>
      <div class="fp-group"><label>City</label><select class="fp-select" id="fCity" onchange="applyFilters()"><option value="">All cities</option></select></div>
      <div class="fp-group"><label>Ground</label><select class="fp-select" id="fGnd" onchange="applyFilters()"><option value="">All grounds</option></select></div>
      <div class="fp-group"><label>Match Innings</label><select class="fp-select" id="fInn" onchange="applyFilters()"><option value="">All innings</option><option value="1">1st innings</option><option value="2">2nd innings</option><option value="3">3rd innings</option><option value="4">4th innings</option></select></div>
      <div class="fp-group"><label>Result</label><select class="fp-select" id="fRes" onchange="applyFilters()"><option value="">All results</option><option value="won">Won</option><option value="lost">Lost</option><option value="drawn">Drawn</option><option value="tied">Tied</option></select></div>
      <div class="fp-group"><label>Toss</label><select class="fp-select" id="fToss" onchange="applyFilters()"><option value="">All</option><option value="won">Won toss</option><option value="lost">Lost toss</option></select></div>
    </div>
    <div class="active-filters" id="activeFilt"></div>
  </div>

  <div class="empty" id="emptyState">
    <div class="empty-ico">&#127951;</div>
    <h2>Select players to compare</h2>
    <p>Search from 3,253 Test cricketers. Compare up to 5 players with filters by opponent, venue, innings, result and more.</p>
  </div>

  <div class="comp" id="comp">
    <div class="tabs">
      <button class="tab on" onclick="switchTab('overview',this)">Overview</button>
      <button class="tab" onclick="switchTab('batting',this)">Batting</button>
      <button class="tab" onclick="switchTab('bowling',this)">Bowling</button>
      <button class="tab" onclick="switchTab('all',this)">All Stats</button>
    </div>
    <div id="filtSummary"></div>
    <div class="tc on" id="t-overview"><div id="tblOverview"></div></div>
    <div class="tc" id="t-batting"><div id="tblBatting"></div></div>
    <div class="tc" id="t-bowling"><div id="tblBowling"></div></div>
    <div class="tc" id="t-all"><div id="tblAll"></div></div>
  </div>
</div>

<div style="text-align:center;padding:40px 20px 30px;font-size:11px;color:var(--text3);">
  Data Source - Ananth Narayanan
</div>

<script src="data.js"></script>
<script>

const KEYS=['id','name','fullName','country','fromYear','toYear','tests','innings','notOuts',
  'batRuns','batBalls','batAvg','wtdBatAvg','hs','fifties','hundreds','avgBatPos',
  'overs','maidens','bowlRuns','wickets','bowlAvg','rpo','bpw','fiveWI','tenWM',
  'bestBowl','catches','stumpings','mom','bowArm','bowType'];

const PLAYERS=D.P.map(r=>{const p={};KEYS.forEach((k,i)=>p[k]=r[i]);return p});
const TEAMS=D.T, CITIES=D.C, GROUNDS=D.G, LOCATIONS=D.L, TESTS=D.M, PT=D.PT, SCD=D.S;

const SCD_IDX={};
SCD.forEach((r,i)=>{const pid=r[1];if(!SCD_IDX[pid])SCD_IDX[pid]=[];SCD_IDX[pid].push(i)});

const cClr={Australia:'#e8b020',England:'#3080e0',India:'#e87020',Pakistan:'#20b060','South Africa':'#18a870','West Indies':'#a05010','New Zealand':'#1a1a2e','Sri Lanka':'#1840b0',Bangladesh:'#188030',Zimbabwe:'#d03030',Afghanistan:'#2060d0',Ireland:'#18a040','ICC World XI':'#666'};
function lum(h){return .299*parseInt(h.slice(1,3),16)/255+.587*parseInt(h.slice(3,5),16)/255+.114*parseInt(h.slice(5,7),16)/255}
function badge(c){const bg=cClr[c]||'#4a5568';return`<span class="ctry-badge" style="background:${bg};color:${lum(bg)>.45?'#1a1e26':'#fff'}">${c}</span>`}
function fmt(v,d=2){if(v===null||v===undefined||v===''||v===0)return'‚Äî';if(typeof v==='number')return Number.isInteger(v)?v.toLocaleString():v.toFixed(d);return v}

function isHome(ptIdx,meta){
  const li=meta[6];if(li<0)return'neutral';
  const loc=LOCATIONS[li],ctry=TEAMS[ptIdx];
  if(ctry===loc)return'home';
  if(loc==='UAE')return'neutral';
  return'away';
}

const PCOLORS=['var(--p1)','var(--p2)','var(--p3)','var(--p4)','var(--p5)'];
const MAX_PLAYERS=5;
let sel=[null,null,null,null,null];
let slotCount=2; // visible slots

function initSearch(n){
  const inp=document.getElementById('s'+n), dd=document.getElementById('d'+n);
  inp.addEventListener('input',()=>{
    const q=inp.value.trim().toLowerCase();
    if(q.length<2){dd.classList.remove('open');return}
    const already=sel.filter(Boolean).map(p=>p.id);
    const m=PLAYERS.filter(p=>!already.includes(p.id)&&(p.name.toLowerCase().includes(q)||p.fullName.toLowerCase().includes(q)||p.country.toLowerCase().includes(q))).slice(0,15);
    dd.innerHTML=m.map(p=>`<div class="dd-item" onclick="pickP(${n},${p.id})"><span><span class="nm">${p.fullName||p.name}</span><span class="yr">${p.fromYear}‚Äì${p.toYear}</span></span><span class="ct">${p.country}</span></div>`).join('');
    dd.classList.add('open');
  });
  inp.addEventListener('focus',()=>{if(inp.value.trim().length>=2)dd.classList.add('open')});
  document.addEventListener('click',e=>{if(!e.target.closest('#c'+n))dd.classList.remove('open')});
}
// Init search for initial 2 slots
[1,2].forEach(initSearch);

// ---- Load comparison from URL parameters ----
function loadFromURL(){
  const params = new URLSearchParams(window.location.search);
  
  // Load players
  const playerIds = [];
  for(let i = 1; i <= MAX_PLAYERS; i++){
    const pid = params.get(`p${i}`);
    if(pid){
      playerIds.push({slot: i, id: parseInt(pid)});
    }
  }
  
  if(playerIds.length > 0){
    // Add slots if needed
    while(slotCount < playerIds.length){
      addPlayerSlot();
    }
    
    // Pick players
    playerIds.forEach(({slot, id}) => {
      const player = PLAYERS.find(p => p.id === id);
      if(player){
        pickP(slot, id);
      }
    });
    
    // Load filters after players are selected
    setTimeout(() => {
      const opp = params.get('opp');
      if(opp){
        opp.split(',').forEach(o => {
          const oppId = parseInt(o);
          if(!selectedOpps.includes(oppId)){
            selectedOpps.push(oppId);
          }
        });
        updateOppToggleLabel();
        populateFilters();
      }
      
      if(params.get('city')) document.getElementById('fCity').value = params.get('city');
      if(params.get('gnd')) document.getElementById('fGnd').value = params.get('gnd');
      if(params.get('ha')) document.getElementById('fHA').value = params.get('ha');
      if(params.get('inn')) document.getElementById('fInn').value = params.get('inn');
      if(params.get('res')) document.getElementById('fRes').value = params.get('res');
      if(params.get('toss')) document.getElementById('fToss').value = params.get('toss');
      
      // Render with filters applied
      if(hasEnough()) render();
    }, 100);
  }
}

// Load from URL on page load
window.addEventListener('DOMContentLoaded', loadFromURL);

function addPlayerSlot(){
  if(slotCount>=MAX_PLAYERS)return;
  slotCount++;
  const n=slotCount;
  const area=document.getElementById('selArea');
  const btn=document.getElementById('addPlayerBtn');
  const card=document.createElement('div');
  card.className='sel-card';card.id='c'+n;
  card.innerHTML=`
    <div class="sel-pcolor" style="color:var(--p${n});background:var(--p${n})"></div>
    <div class="sel-label" style="margin-left:18px">Player ${n}</div>
    <input class="sel-input" id="s${n}" placeholder="Search by name or country..." autocomplete="off">
    <button class="sel-clear" id="x${n}" onclick="clearP(${n})">&times;</button>
    <div class="dd" id="d${n}"></div>
    <div class="sel-info" id="i${n}"><div class="si-name" id="n${n}"></div><div class="si-meta" id="m${n}"></div></div>`;
  area.insertBefore(card,btn);
  initSearch(n);
  if(slotCount>=MAX_PLAYERS)btn.style.display='none';
}

function activeSel(){return sel.filter(Boolean)}
function hasEnough(){return activeSel().length>=2}

function pickP(n,id){
  const p=PLAYERS.find(x=>x.id===id);if(!p)return;
  sel[n-1]=p;
  document.getElementById('s'+n).value='';
  document.getElementById('d'+n).classList.remove('open');
  document.getElementById('n'+n).textContent=p.fullName||p.name;
  document.getElementById('m'+n).innerHTML=badge(p.country)+` ${p.fromYear}‚Äì${p.toYear} ¬∑ ${p.tests} Tests`;
  document.getElementById('i'+n).classList.add('show');
  document.getElementById('x'+n).classList.add('show');
  document.getElementById('c'+n).classList.add('active-'+n);
  if(hasEnough()){populateFilters();document.getElementById('filtersPanel').classList.add('show');render()}
}

function clearP(n){
  sel[n-1]=null;
  document.getElementById('i'+n).classList.remove('show');
  document.getElementById('x'+n).classList.remove('show');
  document.getElementById('c'+n).classList.remove('active-'+n);
  document.getElementById('s'+n).value='';
  if(!hasEnough()){
    document.getElementById('comp').classList.remove('show');
    document.getElementById('emptyState').style.display='block';
    document.getElementById('filtersPanel').classList.remove('show');
  } else { populateFilters(); render(); }
}

// ---- Multi-select Opponent state ----
let selectedOpps=[];
function toggleOppDD(){
  const dd=document.getElementById('fOppDD');
  const btn=document.getElementById('fOppToggle');
  dd.classList.toggle('open');btn.classList.toggle('open');
}
function toggleOppItem(el){
  const v=+el.dataset.val;
  el.classList.toggle('checked');
  if(el.classList.contains('checked')){if(!selectedOpps.includes(v))selectedOpps.push(v)}
  else{selectedOpps=selectedOpps.filter(x=>x!==v)}
  updateOppToggleLabel();applyFilters();
}
function removeOpp(v){
  selectedOpps=selectedOpps.filter(x=>x!==v);
  document.querySelectorAll('#fOppDD .ms-dd-item').forEach(el=>{if(+el.dataset.val===v)el.classList.remove('checked')});
  updateOppToggleLabel();applyFilters();
}
function updateOppToggleLabel(){
  const btn=document.getElementById('fOppToggle');
  if(selectedOpps.length===0)btn.innerHTML='<span class="ms-placeholder">All opponents</span>';
  else if(selectedOpps.length===1)btn.textContent=TEAMS[selectedOpps[0]];
  else btn.textContent=selectedOpps.map(o=>TEAMS[o]).join(', ');
}
// Close dropdown on outside click
document.addEventListener('click',e=>{if(!e.target.closest('#fOppWrap')){document.getElementById('fOppDD').classList.remove('open');document.getElementById('fOppToggle').classList.remove('open')}});

// ---- Filters ----
function populateFilters(){
  const opponents=new Set();
  activeSel().forEach(p=>{const ptIdx=PT[p.id];(SCD_IDX[p.id]||[]).forEach(i=>{const meta=TESTS[SCD[i][0]];if(!meta)return;const opp=meta[2]===ptIdx?meta[3]:meta[2];if(opp>=0)opponents.add(opp)})});
  const oppDD=document.getElementById('fOppDD');
  oppDD.innerHTML='';
  [...opponents].sort((a,b)=>TEAMS[a].localeCompare(TEAMS[b])).forEach(ti=>{
    const checked=selectedOpps.includes(ti)?'checked':'';
    oppDD.innerHTML+=`<div class="ms-dd-item ${checked}" data-val="${ti}" onclick="toggleOppItem(this)"><span class="ms-cb"></span><span class="ms-lbl">${TEAMS[ti]}</span></div>`;
  });
  updateOppToggleLabel();
  const cU=new Set(),gU=new Set();
  activeSel().forEach(p=>{(SCD_IDX[p.id]||[]).forEach(i=>{const meta=TESTS[SCD[i][0]];if(!meta)return;if(meta[0]>=0)cU.add(meta[0]);if(meta[1]>=0)gU.add(meta[1])})});
  const cityS=document.getElementById('fCity');
  cityS.innerHTML='<option value="">All cities</option>';
  [...cU].sort((a,b)=>CITIES[a].localeCompare(CITIES[b])).forEach(ci=>{cityS.innerHTML+=`<option value="${ci}">${CITIES[ci]}</option>`});
  const gndS=document.getElementById('fGnd');
  gndS.innerHTML='<option value="">All grounds</option>';
  [...gU].sort((a,b)=>GROUNDS[a].localeCompare(GROUNDS[b])).forEach(gi=>{gndS.innerHTML+=`<option value="${gi}">${GROUNDS[gi]}</option>`});
}

function getF(){return{opp:selectedOpps,city:document.getElementById('fCity').value,gnd:document.getElementById('fGnd').value,ha:document.getElementById('fHA').value,inn:document.getElementById('fInn').value,res:document.getElementById('fRes').value,toss:document.getElementById('fToss').value}}
function applyFilters(){if(hasEnough())render();showTags()}
function resetFilters(){selectedOpps=[];['fCity','fGnd','fHA','fInn','fRes','fToss'].forEach(id=>{document.getElementById(id).value=''});document.getElementById('activeFilt').innerHTML='';updateOppToggleLabel();document.querySelectorAll('#fOppDD .ms-dd-item').forEach(el=>el.classList.remove('checked'));if(hasEnough())render()}
function ordinal(n){return['','1st','2nd','3rd','4th'][n]||n}
function showTags(){
  const f=getF(),tags=[];
  if(f.opp.length)f.opp.forEach(o=>tags.push({k:'opp_'+o,l:'vs '+TEAMS[o]}));
  if(f.city)tags.push({k:'fCity',l:CITIES[f.city]});
  if(f.gnd)tags.push({k:'fGnd',l:GROUNDS[f.gnd]});
  if(f.ha)tags.push({k:'fHA',l:f.ha[0].toUpperCase()+f.ha.slice(1)});
  if(f.inn)tags.push({k:'fInn',l:ordinal(f.inn)+' innings'});
  if(f.res)tags.push({k:'fRes',l:f.res[0].toUpperCase()+f.res.slice(1)});
  if(f.toss)tags.push({k:'fToss',l:(f.toss==='won'?'Won':'Lost')+' toss'});
  document.getElementById('activeFilt').innerHTML=tags.map(t=>{
    if(t.k.startsWith('opp_')){
      const ov=t.k.split('_')[1];
      return`<span class="af-tag">${t.l}<button onclick="removeOpp(${ov})">&times;</button></span>`;
    }
    return`<span class="af-tag">${t.l}<button onclick="document.getElementById('${t.k}').value='';applyFilters()">&times;</button></span>`;
  }).join('');
}

// ---- Filter + Aggregate ----
function getRows(player){
  const f=getF(),ptIdx=PT[player.id];
  return(SCD_IDX[player.id]||[]).filter(i=>{
    const r=SCD[i],meta=TESTS[r[0]];if(!meta)return false;
    const isT1=(meta[2]===ptIdx),oppIdx=isT1?meta[3]:meta[2];
    if(f.opp.length&&!f.opp.includes(oppIdx))return false;
    if(f.city&&meta[0]!==+f.city)return false;
    if(f.gnd&&meta[1]!==+f.gnd)return false;
    if(f.ha){if(isHome(ptIdx,meta)!==f.ha)return false}
    if(f.inn&&r[2]!==+f.inn)return false;
    if(f.res){const rc=meta[4];if(f.res==='won'&&rc!==ptIdx)return false;if(f.res==='lost'&&(rc===ptIdx||rc<0))return false;if(f.res==='drawn'&&rc!==-1)return false;if(f.res==='tied'&&rc!==-2)return false}
    if(f.toss){const tw=meta[5];if(f.toss==='won'&&tw!==ptIdx)return false;if(f.toss==='lost'&&tw===ptIdx)return false}
    return true;
  });
}

function agg(player,idxs,isFiltered){
  let inns=0,no=0,runs=0,balls=0,hs=0,fifties=0,hundreds=0;
  let overs=0,mdns=0,bR=0,wkts=0,bestW=0,bestR=9999;
  const tests=new Set();
  idxs.forEach(i=>{
    const r=SCD[i];tests.add(r[0]);
    const isNO=r[4];
    if(isNO!==null){
      const br=typeof r[3]==='number'?r[3]:0, bb=typeof r[5]==='number'?r[5]:0;
      inns++;if(isNO)no++;
      runs+=br;balls+=bb;
      if(br>hs)hs=br;if(br>=100)hundreds++;else if(br>=50)fifties++;
    }
    const bo=typeof r[6]==='number'?r[6]:0;
    overs+=bo;mdns+=typeof r[7]==='number'?r[7]:0;
    const brn=typeof r[8]==='number'?r[8]:0, bw=typeof r[9]==='number'?r[9]:0;
    bR+=brn;wkts+=bw;
    if(bw>bestW||(bw===bestW&&brn<bestR)){bestW=bw;bestR=brn}
  });
  
  // Calculate strike rate
  let sr;
  if(!isFiltered){
    // No filters: use career totals from player data
    sr = player.batBalls>0 ? (player.batRuns/player.batBalls)*100 : null;
  } else {
    // Filters active: only show SR for modern players (1990+) with actual balls data
    // For pre-1990 players, balls data is incomplete/unreliable
    const isModernPlayer = player.fromYear >= 1990;
    sr = (isModernPlayer && balls>0) ? (runs/balls)*100 : null;
  }
  
  return{
    tests:tests.size, inns, no, runs, balls,
    batAvg:(inns-no)>0?runs/(inns-no):0,
    sr:sr,
    hs, fifties, hundreds,
    overs:Math.round(overs*10)/10, mdns, bowlRuns:bR, wkts,
    bowlAvg:wkts>0?bR/wkts:0, econ:overs>0?bR/overs:0,
    bpw:wkts>0?(overs*6)/wkts:0,
    bestBowl:bestW>0?bestW+'/'+bestR:'‚Äî',
    name:player.fullName||player.name, country:player.country,
    catches:player.catches, stumpings:player.stumpings, mom:player.mom,
  };
}

// ---- Multi-player Table Builder ----
function buildTable(stats, cols) {
  // Build header row
  let hdr = '<th>Player</th>';
  cols.forEach(c => {
    if(c.sec) hdr += `<th class="sec-head">${c.sec}</th>`;
    else hdr += `<th>${c.label}</th>`;
  });

  // Pre-compute best values for each column
  const bestVals = {};
  cols.forEach(c => {
    if(c.sec || c.higher === null) return;
    const vals = stats.map(s => {
      const v = s[c.key];
      return typeof v === 'number' ? v : 0;
    });
    if(c.higher) bestVals[c.key] = Math.max(...vals);
    else {
      const nonZero = vals.filter(v => v > 0);
      bestVals[c.key] = nonZero.length > 0 ? Math.min(...nonZero) : 0;
    }
  });

  // Build player rows
  let rows = '';
  stats.forEach((s, idx) => {
    let row = `<td class="player-cell"><span class="pc-name">${s.name}</span><span class="pc-meta">${s.country} ¬∑ ${s.tests} Tests</span></td>`;
    cols.forEach(c => {
      if(c.sec) { row += '<td class="sec-div"></td>'; return; }
      const v = s[c.key];
      const n = typeof v === 'number' ? v : 0;
      let cls2 = '';
      if(c.higher !== null && bestVals[c.key] !== undefined) {
        const bv = bestVals[c.key];
        const allSame = stats.every(os => {
          const ov = typeof os[c.key]==='number'?os[c.key]:0;
          return ov === n;
        });
        if(!allSame && (n > 0 || c.higher)) {
          if(c.higher) cls2 = n === bv && n > 0 ? 'best' : (n < bv ? 'worse' : '');
          else {
            if(n === 0) cls2 = '';
            else cls2 = n === bv ? 'best' : 'worse';
          }
        }
      }
      row += `<td class="${cls2}">${fmt(v, c.dec||2)}</td>`;
    });
    rows += `<tr class="p${idx+1}-row">${row}</tr>`;
  });

  return `<div class="tbl-wrap"><table class="cmp-table"><thead><tr>${hdr}</tr></thead><tbody>${rows}</tbody></table></div>`;
}

function switchTab(tab,btn){
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('on'));
  document.querySelectorAll('.tc').forEach(t=>t.classList.remove('on'));
  btn.classList.add('on');
  document.getElementById('t-'+tab).classList.add('on');
}

function render(){
  const players=activeSel();
  if(players.length<2)return;
  document.getElementById('emptyState').style.display='none';
  document.getElementById('comp').classList.add('show');

  // Check filters first
  const f=getF(), any=f.opp.length||f.city||f.gnd||f.ha||f.inn||f.res||f.toss;
  
  const rowSets=players.map(p=>getRows(p));
  const stats=players.map((p,i)=>agg(p,rowSets[i],any));

  // Filter summary
  const sumEl=document.getElementById('filtSummary');
  if(any){
    const parts=[];
    if(f.opp.length)parts.push('vs '+f.opp.map(o=>TEAMS[o]).join(', '));
    if(f.city)parts.push('in '+CITIES[f.city]);
    if(f.gnd)parts.push('at '+GROUNDS[f.gnd]);if(f.ha)parts.push(f.ha);
    if(f.inn)parts.push(ordinal(f.inn)+' inn');if(f.res)parts.push(f.res);
    if(f.toss)parts.push(f.toss+' toss');
    const pParts=stats.map((s,i)=>`${s.name}: ${s.inns} inn`);
    sumEl.innerHTML=`<div class="filt-sum">Filtered: ${parts.join(' ¬∑ ')} ‚Äî ${pParts.join(' ¬∑ ')}</div>`;
  } else sumEl.innerHTML='';

  // Verdict ‚Äî score each player across key metrics
  const scores=stats.map(()=>0);
  const metricWins=stats.map(()=>[]);
  const metricLabels = {
    batAvg: 'Batting Average',
    runs: 'Runs',
    hundreds: 'Centuries',
    wkts: 'Wickets',
    bowlAvg: 'Bowling Average'
  };
  
  function scoreMetric(key, higher, label){
    const vals=stats.map(s=>{const v=s[key];return typeof v==='number'?v:0});
    if(higher){
      const mx=Math.max(...vals);
      if(vals.filter(v=>v===mx).length===1) {
        const winnerIdx = vals.indexOf(mx);
        scores[winnerIdx]++;
        metricWins[winnerIdx].push(label);
      }
    } else {
      const nonZero=vals.map((v,i)=>({v,i})).filter(x=>x.v>0);
      if(nonZero.length>1){
        const mn=Math.min(...nonZero.map(x=>x.v));
        const winners=nonZero.filter(x=>x.v===mn);
        if(winners.length===1) {
          scores[winners[0].i]++;
          metricWins[winners[0].i].push(label);
        }
      }
    }
  }
  scoreMetric('batAvg',true,'Batting Average');
  scoreMetric('runs',true,'Runs');
  scoreMetric('hundreds',true,'Centuries');
  scoreMetric('wkts',true,'Wickets');
  scoreMetric('bowlAvg',false,'Bowling Average');

  const maxSc=Math.max(...scores);
  const leaders=scores.map((s,i)=>({s,i})).filter(x=>x.s===maxSc);
  
  // Build factual summary of who leads in what
  const allDetails = stats.map((s, i) => {
    const wins = metricWins[i];
    if(wins.length > 0){
      return `${s.name} ahead in ${wins.join(', ')}`;
    }
    return null;
  }).filter(Boolean);
  
  const summaryText = allDetails.join(' ¬∑ ');
  
  const verdictHTML=`<div class="verd"><div class="verd-lb">Summary</div><div class="verd-tx">${summaryText}</div></div>`;

  // ---- OVERVIEW ----
  const ovCols = [
    {sec:'Batting'},
    {label:'Tests',key:'tests',higher:true,dec:0},
    {label:'Inns',key:'inns',higher:true,dec:0},
    {label:'Runs',key:'runs',higher:true,dec:0},
    {label:'Bat Avg',key:'batAvg',higher:true},
    {label:'100s',key:'hundreds',higher:true,dec:0},
    {label:'HS',key:'hs',higher:true,dec:0},
    {sec:'Bowling'},
    {label:'Wkts',key:'wkts',higher:true,dec:0},
    {label:'Bowl Avg',key:'bowlAvg',higher:false},
    {label:'Econ',key:'econ',higher:false},
    {label:'Best',key:'bestBowl',higher:null},
    {sec:'Fielding *'},
    {label:'Catches',key:'catches',higher:true,dec:0},
    {label:'St',key:'stumpings',higher:true,dec:0},
    {label:'MoM',key:'mom',higher:true,dec:0},
  ];
  document.getElementById('tblOverview').innerHTML =
    buildTable(stats,ovCols) + verdictHTML +
    '<div class="foot-note">* Career totals ‚Äî not affected by filters</div>';

  // ---- BATTING ----
  const batCols = [
    {label:'Tests',key:'tests',higher:true,dec:0},
    {label:'Innings',key:'inns',higher:true,dec:0},
    {label:'N.O.',key:'no',higher:true,dec:0},
    {label:'Runs',key:'runs',higher:true,dec:0},
    {label:'Balls',key:'balls',higher:true,dec:0},
    {label:'Average',key:'batAvg',higher:true},
    {label:'S/R',key:'sr',higher:true},
    {label:'H.S.',key:'hs',higher:true,dec:0},
    {label:'50s',key:'fifties',higher:true,dec:0},
    {label:'100s',key:'hundreds',higher:true,dec:0},
  ];
  document.getElementById('tblBatting').innerHTML = buildTable(stats,batCols);

  // ---- BOWLING ----
  const bowlCols = [
    {label:'Overs',key:'overs',higher:true,dec:1},
    {label:'Maidens',key:'mdns',higher:true,dec:0},
    {label:'Runs',key:'bowlRuns',higher:false,dec:0},
    {label:'Wickets',key:'wkts',higher:true,dec:0},
    {label:'Average',key:'bowlAvg',higher:false},
    {label:'Economy',key:'econ',higher:false},
    {label:'B/W',key:'bpw',higher:false,dec:1},
    {label:'Best',key:'bestBowl',higher:null},
  ];
  document.getElementById('tblBowling').innerHTML = buildTable(stats,bowlCols);

  // ---- ALL STATS ----
  const allCols = [
    {sec:'Batting'},
    {label:'Tests',key:'tests',higher:true,dec:0},
    {label:'Inns',key:'inns',higher:true,dec:0},
    {label:'N.O.',key:'no',higher:true,dec:0},
    {label:'Runs',key:'runs',higher:true,dec:0},
    {label:'Balls',key:'balls',higher:true,dec:0},
    {label:'Avg',key:'batAvg',higher:true},
    {label:'S/R',key:'sr',higher:true},
    {label:'H.S.',key:'hs',higher:true,dec:0},
    {label:'50s',key:'fifties',higher:true,dec:0},
    {label:'100s',key:'hundreds',higher:true,dec:0},
    {sec:'Bowling'},
    {label:'Overs',key:'overs',higher:true,dec:1},
    {label:'Mdns',key:'mdns',higher:true,dec:0},
    {label:'Runs',key:'bowlRuns',higher:false,dec:0},
    {label:'Wkts',key:'wkts',higher:true,dec:0},
    {label:'Avg',key:'bowlAvg',higher:false},
    {label:'Econ',key:'econ',higher:false},
    {label:'B/W',key:'bpw',higher:false,dec:1},
    {label:'Best',key:'bestBowl',higher:null},
    {sec:'Fielding *'},
    {label:'Ct',key:'catches',higher:true,dec:0},
    {label:'St',key:'stumpings',higher:true,dec:0},
    {label:'MoM',key:'mom',higher:true,dec:0},
  ];
  document.getElementById('tblAll').innerHTML =
    buildTable(stats,allCols) + verdictHTML +
    '<div class="foot-note">* Career totals ‚Äî not affected by filters</div>';

  showTags();
}

// ---- Share Function ----
function shareComparison(){
  const players = activeSel();
  if(players.length < 2){
    alert('Please select at least 2 players to share a comparison.');
    return;
  }
  
  const playerNames = players.map(p => p.fullName || p.name).join(' vs ');
  
  // Build URL with player IDs and filters
  const params = new URLSearchParams();
  
  // Add player IDs
  players.forEach((p, i) => {
    params.append(`p${i+1}`, p.id);
  });
  
  // Add active filters
  const f = getF();
  if(f.opp.length) params.set('opp', f.opp.join(','));
  if(f.city) params.set('city', f.city);
  if(f.gnd) params.set('gnd', f.gnd);
  if(f.ha) params.set('ha', f.ha);
  if(f.inn) params.set('inn', f.inn);
  if(f.res) params.set('res', f.res);
  if(f.toss) params.set('toss', f.toss);
  
  const shareUrl = window.location.origin + window.location.pathname + '?' + params.toString();
  
  // Get current stats and build summary
  const rowSets = players.map(p => getRows(p));
  const stats = players.map((p, i) => agg(p, rowSets[i], f.opp.length || f.city || f.gnd || f.ha || f.inn || f.res || f.toss));
  
  // Calculate metric wins for summary
  const metricWins = stats.map(() => []);
  const metricLabels = {
    batAvg: 'Batting Average',
    runs: 'Runs',
    hundreds: 'Centuries',
    wkts: 'Wickets',
    bowlAvg: 'Bowling Average'
  };
  
  function scoreMetricForShare(key, higher, label){
    const vals = stats.map(s => {const v = s[key]; return typeof v === 'number' ? v : 0});
    if(higher){
      const mx = Math.max(...vals);
      if(vals.filter(v => v === mx).length === 1) {
        const winnerIdx = vals.indexOf(mx);
        metricWins[winnerIdx].push(label);
      }
    } else {
      const nonZero = vals.map((v, i) => ({v, i})).filter(x => x.v > 0);
      if(nonZero.length > 1){
        const mn = Math.min(...nonZero.map(x => x.v));
        const winners = nonZero.filter(x => x.v === mn);
        if(winners.length === 1) {
          metricWins[winners[0].i].push(label);
        }
      }
    }
  }
  
  scoreMetricForShare('batAvg', true, 'Batting Average');
  scoreMetricForShare('runs', true, 'Runs');
  scoreMetricForShare('hundreds', true, 'Centuries');
  scoreMetricForShare('wkts', true, 'Wickets');
  scoreMetricForShare('bowlAvg', false, 'Bowling Average');
  
  // Build summary text
  const summaryParts = stats.map((s, i) => {
    const wins = metricWins[i];
    if(wins.length > 0){
      return `${s.name} ahead in ${wins.join(', ')}`;
    }
    return null;
  }).filter(Boolean);
  
  const summary = summaryParts.length > 0 ? summaryParts.join('. ') + '.' : '';
  
  const shareTitle = `Test Cricket: ${playerNames}`;
  const shareText = summary 
    ? `Compare ${playerNames}. ${summary}` 
    : `Compare ${playerNames} on Test Cricket Side by Side`;
  
  // Try native Web Share API first (works on mobile/iPad)
  if(navigator.share && navigator.canShare && navigator.canShare({url: shareUrl})){
    navigator.share({
      title: shareTitle,
      text: shareText,
      url: shareUrl
    }).catch(err => {
      // Only show fallback if it's not a user cancellation
      if(err.name !== 'AbortError'){
        console.log('Share API failed, using fallback');
        fallbackShare(shareUrl, playerNames);
      }
    });
  } else {
    // Fallback for desktop browsers or if share not supported
    fallbackShare(shareUrl, playerNames);
  }
}

function fallbackShare(url, playerNames){
  // Try clipboard first (may fail due to permissions)
  const tryClipboard = () => {
    if(navigator.clipboard && navigator.clipboard.writeText){
      return navigator.clipboard.writeText(url).then(()=>{
        showCopiedFeedback();
        return true;
      }).catch(()=>false);
    }
    return Promise.resolve(false);
  };
  
  tryClipboard().then(success => {
    if(!success){
      // Clipboard failed or unavailable - use prompt dialog
      showShareDialog(url, playerNames);
    }
  });
}

function showCopiedFeedback(){
  const btn = document.querySelector('.share-btn');
  const originalHTML = btn.innerHTML;
  btn.innerHTML = '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px;stroke:currentColor;fill:none"><polyline points="20 6 9 17 4 12"></polyline></svg><span>Copied!</span>';
  btn.style.color = 'var(--green)';
  btn.style.borderColor = 'var(--green)';
  setTimeout(()=>{
    btn.innerHTML = originalHTML;
    btn.style.color = '';
    btn.style.borderColor = '';
  }, 2000);
}

function showShareDialog(url, playerNames){
  // Use prompt to allow easy copy/paste - works everywhere
  const copied = prompt('Copy this URL to share your comparison:', url);
  
  // If user copied (didn't cancel), show feedback
  if(copied !== null){
    showCopiedFeedback();
  }
}
</script>

</div><!-- end site-content -->

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDhQrnZkxPT1bWE-V5bl39EKJRptPUPSnI",
  authDomain: "hitwicket-cba02.firebaseapp.com",
  projectId: "hitwicket-cba02",
  storageBucket: "hitwicket-cba02.firebasestorage.app",
  messagingSenderId: "196915483829",
  appId: "1:196915483829:web:071c47af79914aec88dafc"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const STORAGE_KEY = 'cricket_site_auth';
const DEFAULT_PASSWORD = 'mylaptopismAI!';
let sitePassword = DEFAULT_PASSWORD;

// Eye icons SVG
const eyeOpen = `<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>`;
const eyeClosed = `<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>`;

function togglePassword() {
  const input = document.getElementById('passwordInput');
  const icon = document.getElementById('eyeIcon');
  if (input.type === 'password') {
    input.type = 'text';
    icon.innerHTML = eyeClosed;
  } else {
    input.type = 'password';
    icon.innerHTML = eyeOpen;
  }
}

// Load password from Firestore
async function loadPassword() {
  try {
    const doc = await db.collection('settings').doc('site').get();
    if (doc.exists && doc.data().password) {
      sitePassword = doc.data().password;
    } else {
      // Initialize with default password
      await db.collection('settings').doc('site').set({ password: DEFAULT_PASSWORD });
    }
  } catch (e) {
    console.error('Error loading password:', e);
  }
}

async function checkPassword() {
  const emailInput = document.getElementById('emailInput');
  const passwordInput = document.getElementById('passwordInput');
  const error = document.getElementById('passwordError');
  
  const email = emailInput.value.trim();
  const password = passwordInput.value;
  
  if (!email) {
    emailInput.classList.add('error');
    setTimeout(() => emailInput.classList.remove('error'), 400);
    return;
  }
  
  await loadPassword();
  
  if (password === sitePassword) {
    // Log the login to Firestore
    try {
      await db.collection('logins').add({
        email: email,
        page: 'index.html',
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
      
      // Start session tracking
      const sessionRef = await db.collection('sessions').add({
        email: email,
        startTime: firebase.firestore.FieldValue.serverTimestamp(),
        page: 'index.html'
      });
      sessionStorage.setItem('cricket_session_id', sessionRef.id);
      sessionStorage.setItem('cricket_session_start', Date.now().toString());
    } catch (e) {
      console.error('Error logging login:', e);
    }
    
    sessionStorage.setItem(STORAGE_KEY, 'authenticated');
    sessionStorage.setItem('cricket_user_email', email);
    unlockSite();
  } else {
    passwordInput.classList.add('error');
    error.classList.add('show');
    setTimeout(() => {
      passwordInput.classList.remove('error');
    }, 400);
  }
}

function unlockSite() {
  document.getElementById('passwordOverlay').classList.add('hidden');
  document.getElementById('siteContent').classList.add('unlocked');
  setTimeout(() => {
    document.getElementById('passwordOverlay').style.display = 'none';
  }, 400);
}

// Track session end on page unload
window.addEventListener('beforeunload', async () => {
  const sessionId = sessionStorage.getItem('cricket_session_id');
  const sessionStart = sessionStorage.getItem('cricket_session_start');
  if (sessionId && sessionStart) {
    const duration = Math.round((Date.now() - parseInt(sessionStart)) / 1000);
    try {
      await db.collection('sessions').doc(sessionId).update({
        endTime: firebase.firestore.FieldValue.serverTimestamp(),
        duration: duration
      });
    } catch (e) {
      console.error('Error updating session:', e);
    }
  }
});

// Check if already authenticated this session
if (sessionStorage.getItem(STORAGE_KEY) === 'authenticated') {
  unlockSite();
} else {
  document.getElementById('emailInput').focus();
}
</script>
</body>
</html>