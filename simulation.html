<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<title>Test Cricket — Simulation</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
:root{
  --bg:#f4f5f7;--surface:#ffffff;--surface2:#f0f1f4;--surface3:#e8eaef;
  --border:#d8dce3;--border2:#c8cdd6;
  --text:#1a1e26;--text2:#5a6578;--text3:#8896a8;
  --accent:#c08018;--accent-dim:rgba(192,128,24,0.10);--accent-glow:rgba(192,128,24,0.06);
  --green:#1a9a60;--green-dim:rgba(26,154,96,0.10);
  --red:#d04040;--red-dim:rgba(208,64,64,0.10);
  --blue:#2870d0;--blue-dim:rgba(40,112,208,0.10);
}
body{background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;min-height:100vh;overflow-x:hidden}

/* Header */
.header{
  padding:22px 32px 16px;position:relative;
  background:linear-gradient(180deg,#eaecf0 0%,var(--bg) 100%);
  border-bottom:1px solid var(--border);
}
.header::after{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 25% -20%,var(--accent-glow),transparent 60%);pointer-events:none}
.hdr-inner{max-width:1440px;margin:0 auto;position:relative;display:flex;justify-content:space-between;align-items:center}
.brand{display:flex;align-items:center;gap:12px}
.brand-icon{
  width:36px;height:36px;border-radius:8px;
  background:linear-gradient(135deg,var(--accent),#8a5810);
  display:flex;align-items:center;justify-content:center;
  font-size:14px;font-weight:800;color:#fff;letter-spacing:-0.5px;
  box-shadow:0 3px 14px rgba(192,128,24,0.30);
}
.brand h1{font-family:'DM Serif Display',serif;font-size:21px;letter-spacing:-0.3px}
.brand-sub{font-size:11.5px;color:var(--text3);margin-top:2px;margin-left:48px}

.hdr-nav{display:flex;align-items:center;gap:8px}
.share-btn{
  background:var(--surface);border:1px solid var(--border);border-radius:8px;
  padding:8px 16px;cursor:pointer;display:flex;align-items:center;gap:8px;
  font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;
  color:var(--text2);transition:all 0.2s;
}
.share-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}
.share-btn svg{width:16px;height:16px;stroke:currentColor;fill:none}
.nav-link{
  background:var(--surface);border:1px solid var(--border);border-radius:8px;
  padding:8px 16px;cursor:pointer;display:flex;align-items:center;gap:7px;
  font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;
  color:var(--text2);transition:all 0.2s;text-decoration:none;
}
.nav-link:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}
.nav-link.active{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}
.nav-link svg{width:15px;height:15px;stroke:currentColor;fill:none;flex-shrink:0}

.main{max-width:1440px;margin:0 auto;padding:20px 32px 60px}

.page-head{margin-bottom:18px}
.page-title{font-family:'DM Serif Display',serif;font-size:26px;letter-spacing:-0.4px;margin-bottom:4px}
.page-desc{font-size:13px;color:var(--text2)}

/* Weights Panel */
.weights-panel{
  background:var(--surface);border:1px solid var(--border);border-radius:14px;
  padding:24px 28px;margin-bottom:24px;
}
.wp-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.wp-title{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3)}
.wp-actions{display:flex;align-items:center;gap:12px}
.wp-reset{
  font-size:11px;color:var(--accent);background:none;border:none;cursor:pointer;
  font-family:'Outfit',sans-serif;font-weight:600;
}
.wp-reset:hover{text-decoration:underline}
.wp-apply{
  background:linear-gradient(135deg,var(--accent),#8a5810);
  border:none;border-radius:8px;padding:10px 20px;
  color:#fff;font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;
  cursor:pointer;transition:all 0.2s;
  box-shadow:0 3px 14px rgba(192,128,24,0.25);
}
.wp-apply:hover{transform:translateY(-1px);box-shadow:0 5px 20px rgba(192,128,24,0.35)}

/* Weight Groups Grid */
.weights-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
  gap:16px;
}

.weight-group{
  background:var(--surface2);border:1px solid var(--border);border-radius:10px;
  padding:16px 18px;
}
.weight-group.has-error{border-color:var(--red)}

.wg-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.wg-title{font-size:13px;font-weight:600;color:var(--text);display:flex;align-items:center;gap:8px}
.wg-title svg{width:16px;height:16px;stroke:var(--accent);fill:none}

/* Total input row */
.wg-total-row{
  display:flex;align-items:center;gap:10px;
  padding:10px 14px;margin-bottom:10px;
  background:linear-gradient(135deg,var(--accent-dim),rgba(192,128,24,0.05));
  border:2px solid var(--accent);border-radius:8px;
}
.wg-total-label{flex:1;font-size:12px;font-weight:600;color:var(--accent)}
.wg-total-input{
  width:80px;background:var(--surface);border:2px solid var(--accent);border-radius:6px;
  padding:8px 10px;color:var(--accent);font-family:'Outfit',sans-serif;font-size:14px;
  font-weight:700;text-align:center;outline:none;
}
.wg-total-input:focus{background:var(--surface)}
.wg-total-input::placeholder{color:var(--text3);font-weight:400}
.wg-total-unit{font-size:12px;color:var(--accent);font-weight:600}

/* Sub-total status */
.wg-subtotal{
  display:flex;align-items:center;justify-content:space-between;
  padding:6px 12px;margin-bottom:8px;
  background:var(--surface);border-radius:5px;
  font-size:11px;
}
.wg-subtotal-label{color:var(--text3)}
.wg-subtotal-value{font-weight:700}
.wg-subtotal-value.valid{color:var(--green)}
.wg-subtotal-value.invalid{color:var(--red)}

/* Weight Item Row */
.weight-item{
  display:flex;align-items:center;gap:10px;
  padding:8px 12px;margin-bottom:6px;
  background:var(--surface);border:1px solid var(--border);border-radius:6px;
  transition:border-color 0.2s;
}
.weight-item:last-child{margin-bottom:0}
.weight-item:hover{border-color:var(--border2)}
.weight-item.has-value{border-color:rgba(192,128,24,0.4);background:rgba(192,128,24,0.03)}
.weight-item.disabled{opacity:0.5;pointer-events:none}

.wi-label{flex:1;font-size:12px;font-weight:500;color:var(--text)}
.wi-input{
  width:70px;background:var(--surface2);border:1px solid var(--border);border-radius:5px;
  padding:6px 8px;color:var(--text);font-family:'Outfit',sans-serif;font-size:12px;
  font-weight:600;text-align:center;outline:none;
}
.wi-input:focus{border-color:var(--accent);background:var(--surface)}
.wi-input::placeholder{color:var(--text3);font-weight:400}
.wi-unit{font-size:11px;color:var(--text3);font-weight:500;min-width:16px}

/* Auto-populated row */
.weight-item.auto-row{
  background:var(--surface);border-color:var(--border);
}
.wi-auto{
  font-size:13px;font-weight:600;color:var(--text);min-width:50px;text-align:center;
}
.wi-auto-badge{
  font-size:9px;font-weight:700;letter-spacing:0.5px;text-transform:uppercase;
  background:var(--blue-dim);color:var(--blue);padding:2px 6px;border-radius:3px;
}

/* Group note */
.wg-note{
  display:flex;align-items:center;gap:6px;margin-top:10px;padding:8px 10px;
  background:var(--surface);border-radius:5px;
  font-size:10px;color:var(--text3);line-height:1.4;
}
.wg-note svg{width:14px;height:14px;stroke:var(--text3);fill:none;flex-shrink:0}

/* Grand Total */
.total-weight{
  margin-top:20px;padding-top:20px;border-top:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
}
.tw-label{font-size:12px;font-weight:600;color:var(--text2)}
.tw-value{font-family:'DM Serif Display',serif;font-size:28px;color:var(--accent);letter-spacing:-0.5px}
.tw-status{font-size:11px;font-weight:600;padding:4px 12px;border-radius:5px}
.tw-status.valid{background:var(--green-dim);color:var(--green)}
.tw-status.invalid{background:var(--red-dim);color:var(--red)}

/* Active Weights Tags */
.active-weights{display:flex;flex-wrap:wrap;gap:6px;margin-top:16px}
.aw-tag{
  display:inline-flex;align-items:center;gap:5px;padding:4px 10px;
  background:var(--accent-dim);border:1px solid rgba(192,128,24,0.25);
  border-radius:6px;font-size:11px;color:var(--accent);font-weight:500;
}
.aw-tag .aw-val{font-weight:700}
.aw-tag button{background:none;border:none;color:var(--accent);cursor:pointer;font-size:13px;line-height:1;opacity:0.7}
.aw-tag button:hover{opacity:1}

/* Info Panel */
.info-panel{
  background:var(--blue-dim);border:1px solid rgba(40,112,208,0.2);border-radius:10px;
  padding:14px 18px;margin-bottom:24px;display:flex;align-items:start;gap:12px;
}
.info-panel svg{width:18px;height:18px;stroke:var(--blue);fill:none;flex-shrink:0;margin-top:1px}
.info-text{font-size:12px;color:var(--text2);line-height:1.5}
.info-text strong{color:var(--text);font-weight:600}

/* Preview Panel */
.preview-panel{
  background:var(--surface);border:1px solid var(--border);border-radius:14px;
  padding:24px 28px;
}
.pp-title{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);margin-bottom:16px}
.pp-empty{text-align:center;padding:40px 20px;color:var(--text3);font-size:13px}
.pp-empty svg{width:40px;height:40px;stroke:var(--border2);fill:none;margin-bottom:12px}
.preview-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px}
.preview-card{background:var(--surface2);border-radius:8px;padding:14px 16px}
.pc-label{font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--text3);margin-bottom:6px}
.pc-value{font-family:'DM Serif Display',serif;font-size:22px;color:var(--accent)}
.pc-sub{font-size:11px;color:var(--text2);margin-top:2px}

@media(max-width:768px){
  .header{padding:16px 18px 14px}
  .hdr-inner{flex-direction:column;align-items:flex-start;gap:12px}
  .brand-sub{margin-left:0;margin-top:4px}
  .hdr-nav{flex-wrap:wrap}
  .nav-link span{display:none}
  .nav-link{padding:8px 10px}
  .share-btn{padding:8px 10px;font-size:0}
  .share-btn svg{margin:0}
  .share-btn span{display:none}
  .main{padding:16px 18px 40px}
  .weights-panel{padding:18px 16px}
  .weights-grid{grid-template-columns:1fr}
  .total-weight{flex-wrap:wrap;gap:12px}
}
</style>
</head>
<body>

<header class="header">
  <div class="hdr-inner">
    <div class="brand">
      <div class="brand-icon">TC</div>
      <div>
        <h1>Test Cricket Side by Side</h1>
        <div class="brand-sub">Simulation Weights</div>
      </div>
    </div>
    <nav class="hdr-nav">
      <a class="nav-link" href="index.html">
        <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        <span>Compare</span>
      </a>
      <a class="nav-link" href="batting-records.html">
        <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line></svg>
        <span>Batting</span>
      </a>
      <a class="nav-link" href="country-results.html">
        <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
        <span>Countries</span>
      </a>
      <a class="nav-link active" href="simulation.html">
        <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="3"></rect><circle cx="8" cy="8" r="1.5" fill="currentColor" stroke="none"></circle><circle cx="16" cy="8" r="1.5" fill="currentColor" stroke="none"></circle><circle cx="8" cy="16" r="1.5" fill="currentColor" stroke="none"></circle><circle cx="16" cy="16" r="1.5" fill="currentColor" stroke="none"></circle><circle cx="12" cy="12" r="1.5" fill="currentColor" stroke="none"></circle></svg>
        <span>Simulation</span>
      </a>
      <button class="share-btn" onclick="sharePage()">
        <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="18" cy="5" r="3"></circle>
          <circle cx="6" cy="12" r="3"></circle>
          <circle cx="18" cy="19" r="3"></circle>
          <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
          <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
        </svg>
        <span>Share</span>
      </button>
    </nav>
  </div>
</header>

<main class="main">
  <div class="page-head">
    <h2 class="page-title">Simulation Weights</h2>
    <p class="page-desc">Configure weights for different performance factors to run custom simulations</p>
  </div>

  <div class="info-panel">
    <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
    <div class="info-text">
      <strong>How weights work:</strong> Set a total weight for each category, then distribute that total among the sub-options. 
      All category totals must sum to 100%, and each category's sub-options must sum to its total.
    </div>
  </div>

  <div class="weights-panel">
    <div class="wp-header">
      <span class="wp-title">Factor Weights</span>
      <div class="wp-actions">
        <button class="wp-reset" onclick="resetWeights()">Reset All</button>
        <button class="wp-apply" onclick="applyWeights()">Apply Weights</button>
      </div>
    </div>

    <div class="weights-grid">
      <!-- Batting Average -->
      <div class="weight-group" id="avgGroup">
        <div class="wg-header">
          <span class="wg-title">
            <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
            Batting Average
          </span>
        </div>
        <div class="wg-total-row">
          <span class="wg-total-label">Category Total</span>
          <input type="number" class="wg-total-input" id="avgTotal" min="0" max="100" placeholder="0" oninput="updateTotal('avg')">
          <span class="wg-total-unit">%</span>
        </div>
        <div class="wg-subtotal">
          <span class="wg-subtotal-label">Sub-total:</span>
          <span class="wg-subtotal-value" id="avgSubtotal">0 / 0%</span>
        </div>
        <div class="weight-item disabled" id="avg1Item">
          <span class="wi-label">1st Innings</span>
          <input type="number" class="wi-input" id="avg1" min="0" max="100" placeholder="0" oninput="updateSub('avg','1')">
          <span class="wi-unit">%</span>
        </div>
        <div class="weight-item disabled" id="avg2Item">
          <span class="wi-label">2nd Innings</span>
          <input type="number" class="wi-input" id="avg2" min="0" max="100" placeholder="0" oninput="updateSub('avg','2')">
          <span class="wi-unit">%</span>
        </div>
        <div class="weight-item disabled" id="avg3Item">
          <span class="wi-label">3rd Innings</span>
          <input type="number" class="wi-input" id="avg3" min="0" max="100" placeholder="0" oninput="updateSub('avg','3')">
          <span class="wi-unit">%</span>
        </div>
        <div class="weight-item disabled" id="avg4Item">
          <span class="wi-label">4th Innings</span>
          <input type="number" class="wi-input" id="avg4" min="0" max="100" placeholder="0" oninput="updateSub('avg','4')">
          <span class="wi-unit">%</span>
        </div>
      </div>

      <!-- Strike Rate -->
      <div class="weight-group" id="srGroup">
        <div class="wg-header">
          <span class="wg-title">
            <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
            Strike Rate
          </span>
        </div>
        <div class="wg-total-row">
          <span class="wg-total-label">Category Total</span>
          <input type="number" class="wg-total-input" id="srTotal" min="0" max="100" placeholder="0" oninput="updateTotal('sr')">
          <span class="wg-total-unit">%</span>
        </div>
        <div class="wg-note">
          <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
          Single metric — total applies directly
        </div>
      </div>

      <!-- Runs Scored -->
      <div class="weight-group" id="runsGroup">
        <div class="wg-header">
          <span class="wg-title">
            <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
            Runs Scored
          </span>
        </div>
        <div class="wg-total-row">
          <span class="wg-total-label">Category Total</span>
          <input type="number" class="wg-total-input" id="runsTotal" min="0" max="100" placeholder="0" oninput="updateTotal('runs')">
          <span class="wg-total-unit">%</span>
        </div>
        <div class="wg-subtotal">
          <span class="wg-subtotal-label">Sub-total:</span>
          <span class="wg-subtotal-value" id="runsSubtotal">0 / 0%</span>
        </div>
        <div class="weight-item disabled" id="runs1Item">
          <span class="wi-label">1st Innings</span>
          <input type="number" class="wi-input" id="runs1" min="0" max="100" placeholder="0" oninput="updateSub('runs','1')">
          <span class="wi-unit">%</span>
        </div>
        <div class="weight-item disabled" id="runs2Item">
          <span class="wi-label">2nd Innings</span>
          <input type="number" class="wi-input" id="runs2" min="0" max="100" placeholder="0" oninput="updateSub('runs','2')">
          <span class="wi-unit">%</span>
        </div>
        <div class="weight-item disabled" id="runs3Item">
          <span class="wi-label">3rd Innings</span>
          <input type="number" class="wi-input" id="runs3" min="0" max="100" placeholder="0" oninput="updateSub('runs','3')">
          <span class="wi-unit">%</span>
        </div>
        <div class="weight-item disabled" id="runs4Item">
          <span class="wi-label">4th Innings</span>
          <input type="number" class="wi-input" id="runs4" min="0" max="100" placeholder="0" oninput="updateSub('runs','4')">
          <span class="wi-unit">%</span>
        </div>
      </div>

      <!-- Impact -->
      <div class="weight-group" id="impactGroup">
        <div class="wg-header">
          <span class="wg-title">
            <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
            Impact
          </span>
        </div>
        <div class="wg-total-row">
          <span class="wg-total-label">Category Total</span>
          <input type="number" class="wg-total-input" id="impactTotal" min="0" max="100" placeholder="0" oninput="updateTotal('impact')">
          <span class="wg-total-unit">%</span>
        </div>
        <div class="wg-subtotal">
          <span class="wg-subtotal-label">Sub-total:</span>
          <span class="wg-subtotal-value" id="impactSubtotal">0 / 0%</span>
        </div>
        <div class="weight-item auto-row">
          <span class="wi-label">1st Innings</span>
          <span class="wi-auto" id="impact1Val">0%</span>
          <span class="wi-auto-badge">auto</span>
        </div>
        <div class="weight-item auto-row">
          <span class="wi-label">2nd Innings</span>
          <span class="wi-auto" id="impact2Val">0%</span>
          <span class="wi-auto-badge">auto</span>
        </div>
        <div class="weight-item auto-row">
          <span class="wi-label">3rd Innings</span>
          <span class="wi-auto" id="impact3Val">0%</span>
          <span class="wi-auto-badge">auto</span>
        </div>
        <div class="weight-item auto-row">
          <span class="wi-label">4th Innings</span>
          <span class="wi-auto" id="impact4Val">0%</span>
          <span class="wi-auto-badge">auto</span>
        </div>
        <div class="wg-note">
          <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
          Auto-distributes based on Runs Scored weights
        </div>
      </div>

      <!-- Home & Away -->
      <div class="weight-group" id="haGroup">
        <div class="wg-header">
          <span class="wg-title">
            <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            Home & Away
          </span>
        </div>
        <div class="wg-total-row">
          <span class="wg-total-label">Category Total</span>
          <input type="number" class="wg-total-input" id="haTotal" min="0" max="100" placeholder="0" oninput="updateTotal('ha')">
          <span class="wg-total-unit">%</span>
        </div>
        <div class="wg-subtotal">
          <span class="wg-subtotal-label">Sub-total:</span>
          <span class="wg-subtotal-value" id="haSubtotal">0 / 0%</span>
        </div>
        <div class="weight-item disabled" id="haHomeItem">
          <span class="wi-label">Home</span>
          <input type="number" class="wi-input" id="haHome" min="0" max="100" placeholder="0" oninput="updateSub('ha','home')">
          <span class="wi-unit">%</span>
        </div>
        <div class="weight-item disabled" id="haAwayItem">
          <span class="wi-label">Away</span>
          <input type="number" class="wi-input" id="haAway" min="0" max="100" placeholder="0" oninput="updateSub('ha','away')">
          <span class="wi-unit">%</span>
        </div>
        <div class="weight-item disabled" id="haNeutralItem">
          <span class="wi-label">Neutral</span>
          <input type="number" class="wi-input" id="haNeutral" min="0" max="100" placeholder="0" oninput="updateSub('ha','neutral')">
          <span class="wi-unit">%</span>
        </div>
      </div>

      <!-- Match Result -->
      <div class="weight-group" id="resultGroup">
        <div class="wg-header">
          <span class="wg-title">
            <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
            Match Result
          </span>
        </div>
        <div class="wg-total-row">
          <span class="wg-total-label">Category Total</span>
          <input type="number" class="wg-total-input" id="resultTotal" min="0" max="100" placeholder="0" oninput="updateTotal('result')">
          <span class="wg-total-unit">%</span>
        </div>
        <div class="wg-subtotal">
          <span class="wg-subtotal-label">Sub-total:</span>
          <span class="wg-subtotal-value" id="resultSubtotal">0 / 0%</span>
        </div>
        <div class="weight-item disabled" id="resultWinItem">
          <span class="wi-label">Win</span>
          <input type="number" class="wi-input" id="resultWin" min="0" max="100" placeholder="0" oninput="updateSub('result','win')">
          <span class="wi-unit">%</span>
        </div>
        <div class="weight-item disabled" id="resultLossItem">
          <span class="wi-label">Loss</span>
          <input type="number" class="wi-input" id="resultLoss" min="0" max="100" placeholder="0" oninput="updateSub('result','loss')">
          <span class="wi-unit">%</span>
        </div>
        <div class="weight-item disabled" id="resultDrawItem">
          <span class="wi-label">Draw</span>
          <input type="number" class="wi-input" id="resultDraw" min="0" max="100" placeholder="0" oninput="updateSub('result','draw')">
          <span class="wi-unit">%</span>
        </div>
      </div>
    </div>

    <div class="total-weight">
      <div>
        <span class="tw-label">Grand Total</span>
        <div class="tw-value" id="grandTotal">0%</div>
      </div>
      <span class="tw-status invalid" id="grandStatus">Needs to equal 100%</span>
    </div>

    <div class="active-weights" id="activeTags"></div>
  </div>

  <div class="preview-panel">
    <div class="pp-title">Configuration Preview</div>
    <div class="pp-empty" id="previewEmpty">
      <svg viewBox="0 0 24 24" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg>
      <div>Set weights above to configure your simulation</div>
    </div>
    <div class="preview-grid" id="previewContent" style="display:none"></div>
  </div>
</main>

<script>
// Configuration
const config = {
  avg: { total: 0, subs: { '1': 0, '2': 0, '3': 0, '4': 0 }, subKeys: ['1','2','3','4'] },
  sr: { total: 0, subs: {}, subKeys: [] }, // No subs, total applies directly
  runs: { total: 0, subs: { '1': 0, '2': 0, '3': 0, '4': 0 }, subKeys: ['1','2','3','4'] },
  impact: { total: 0, subs: { '1': 0, '2': 0, '3': 0, '4': 0 }, subKeys: ['1','2','3','4'], auto: true },
  ha: { total: 0, subs: { home: 0, away: 0, neutral: 0 }, subKeys: ['home','away','neutral'] },
  result: { total: 0, subs: { win: 0, loss: 0, draw: 0 }, subKeys: ['win','loss','draw'] }
};

const labels = {
  avg: { name: 'Average', '1': '1st Innings', '2': '2nd Innings', '3': '3rd Innings', '4': '4th Innings' },
  sr: { name: 'Strike Rate' },
  runs: { name: 'Runs', '1': '1st Innings', '2': '2nd Innings', '3': '3rd Innings', '4': '4th Innings' },
  impact: { name: 'Impact', '1': '1st Innings', '2': '2nd Innings', '3': '3rd Innings', '4': '4th Innings' },
  ha: { name: 'Venue', home: 'Home', away: 'Away', neutral: 'Neutral' },
  result: { name: 'Result', win: 'Win', loss: 'Loss', draw: 'Draw' }
};

const inputMap = {
  'avg-1': 'avg1', 'avg-2': 'avg2', 'avg-3': 'avg3', 'avg-4': 'avg4',
  'runs-1': 'runs1', 'runs-2': 'runs2', 'runs-3': 'runs3', 'runs-4': 'runs4',
  'ha-home': 'haHome', 'ha-away': 'haAway', 'ha-neutral': 'haNeutral',
  'result-win': 'resultWin', 'result-loss': 'resultLoss', 'result-draw': 'resultDraw'
};

const itemMap = {
  'avg-1': 'avg1Item', 'avg-2': 'avg2Item', 'avg-3': 'avg3Item', 'avg-4': 'avg4Item',
  'runs-1': 'runs1Item', 'runs-2': 'runs2Item', 'runs-3': 'runs3Item', 'runs-4': 'runs4Item',
  'ha-home': 'haHomeItem', 'ha-away': 'haAwayItem', 'ha-neutral': 'haNeutralItem',
  'result-win': 'resultWinItem', 'result-loss': 'resultLossItem', 'result-draw': 'resultDrawItem'
};

function updateTotal(group) {
  const input = document.getElementById(group + 'Total');
  let val = parseInt(input.value) || 0;
  if (val < 0) val = 0;
  if (val > 100) val = 100;
  config[group].total = val;
  
  // Enable/disable sub-items
  const subKeys = config[group].subKeys;
  if (subKeys.length > 0 && !config[group].auto) {
    subKeys.forEach(key => {
      const itemId = itemMap[`${group}-${key}`];
      if (itemId) {
        const item = document.getElementById(itemId);
        if (val > 0) {
          item.classList.remove('disabled');
        } else {
          item.classList.add('disabled');
          // Reset sub values
          config[group].subs[key] = 0;
          const inputId = inputMap[`${group}-${key}`];
          if (inputId) document.getElementById(inputId).value = '';
        }
      }
    });
  }
  
  // Auto-distribute for impact based on runs
  if (group === 'impact') {
    updateImpactDistribution();
  }
  
  // If runs changed, also update impact
  if (group === 'runs') {
    updateImpactDistribution();
  }
  
  updateSubtotal(group);
  updateGrandTotal();
  updateTags();
  updatePreview();
}

function updateSub(group, key) {
  const inputId = inputMap[`${group}-${key}`];
  const itemId = itemMap[`${group}-${key}`];
  const input = document.getElementById(inputId);
  const item = document.getElementById(itemId);
  
  let val = parseInt(input.value) || 0;
  if (val < 0) val = 0;
  
  config[group].subs[key] = val;
  
  if (val > 0) {
    item.classList.add('has-value');
  } else {
    item.classList.remove('has-value');
  }
  
  // If runs changed, update impact
  if (group === 'runs') {
    updateImpactDistribution();
  }
  
  updateSubtotal(group);
  updateGrandTotal();
  updateTags();
  updatePreview();
}

function updateImpactDistribution() {
  const impactTotal = config.impact.total;
  const runsSubs = config.runs.subs;
  const runsSubTotal = Object.values(runsSubs).reduce((a, b) => a + b, 0);
  
  if (impactTotal > 0 && runsSubTotal > 0) {
    // Distribute based on runs proportions
    let distributed = 0;
    const keys = ['1', '2', '3', '4'];
    keys.forEach((key, idx) => {
      if (idx < 3) {
        const proportion = runsSubs[key] / runsSubTotal;
        const val = Math.round(impactTotal * proportion);
        config.impact.subs[key] = val;
        distributed += val;
      } else {
        // Last one gets remainder
        config.impact.subs[key] = impactTotal - distributed;
      }
      document.getElementById('impact' + key + 'Val').textContent = config.impact.subs[key] + '%';
    });
  } else if (impactTotal > 0) {
    // Equal distribution
    const each = Math.floor(impactTotal / 4);
    const remainder = impactTotal - (each * 4);
    ['1', '2', '3', '4'].forEach((key, idx) => {
      const val = each + (idx < remainder ? 1 : 0);
      config.impact.subs[key] = val;
      document.getElementById('impact' + key + 'Val').textContent = val + '%';
    });
  } else {
    ['1', '2', '3', '4'].forEach(key => {
      config.impact.subs[key] = 0;
      document.getElementById('impact' + key + 'Val').textContent = '0%';
    });
  }
  
  updateSubtotal('impact');
}

function updateSubtotal(group) {
  const cfg = config[group];
  const subKeys = cfg.subKeys;
  
  if (subKeys.length === 0) return; // sr has no subs
  
  const subTotal = Object.values(cfg.subs).reduce((a, b) => a + b, 0);
  const target = cfg.total;
  const el = document.getElementById(group + 'Subtotal');
  const groupEl = document.getElementById(group + 'Group');
  
  if (el) {
    el.textContent = `${subTotal} / ${target}%`;
    if (target === 0) {
      el.className = 'wg-subtotal-value';
      groupEl.classList.remove('has-error');
    } else if (subTotal === target) {
      el.className = 'wg-subtotal-value valid';
      groupEl.classList.remove('has-error');
    } else {
      el.className = 'wg-subtotal-value invalid';
      groupEl.classList.add('has-error');
    }
  }
}

function updateGrandTotal() {
  const total = Object.values(config).reduce((sum, cfg) => sum + cfg.total, 0);
  document.getElementById('grandTotal').textContent = total + '%';
  
  const status = document.getElementById('grandStatus');
  if (total === 100) {
    status.textContent = 'Valid configuration';
    status.className = 'tw-status valid';
  } else if (total === 0) {
    status.textContent = 'Needs to equal 100%';
    status.className = 'tw-status invalid';
  } else if (total < 100) {
    status.textContent = (100 - total) + '% remaining';
    status.className = 'tw-status invalid';
  } else {
    status.textContent = (total - 100) + '% over limit';
    status.className = 'tw-status invalid';
  }
}

function updateTags() {
  const tags = [];
  
  for (const [group, cfg] of Object.entries(config)) {
    if (cfg.total > 0) {
      if (cfg.subKeys.length === 0) {
        // Strike rate - no subs
        tags.push(`<span class="aw-tag">${labels[group].name}: <span class="aw-val">${cfg.total}%</span><button onclick="clearGroup('${group}')">&times;</button></span>`);
      } else {
        for (const [key, val] of Object.entries(cfg.subs)) {
          if (val > 0) {
            const keyLabel = labels[group][key];
            tags.push(`<span class="aw-tag">${labels[group].name} (${keyLabel}): <span class="aw-val">${val}%</span><button onclick="clearSub('${group}','${key}')">&times;</button></span>`);
          }
        }
      }
    }
  }
  
  document.getElementById('activeTags').innerHTML = tags.join('');
}

function updatePreview() {
  const total = Object.values(config).reduce((sum, cfg) => sum + cfg.total, 0);
  const empty = document.getElementById('previewEmpty');
  const content = document.getElementById('previewContent');
  
  if (total === 0) {
    empty.style.display = 'block';
    content.style.display = 'none';
    return;
  }
  
  empty.style.display = 'none';
  content.style.display = 'grid';
  
  let html = '';
  for (const [group, cfg] of Object.entries(config)) {
    if (cfg.total > 0) {
      if (cfg.subKeys.length === 0) {
        html += `<div class="preview-card"><div class="pc-label">${labels[group].name}</div><div class="pc-value">${cfg.total}%</div><div class="pc-sub">Overall</div></div>`;
      } else {
        for (const [key, val] of Object.entries(cfg.subs)) {
          if (val > 0) {
            html += `<div class="preview-card"><div class="pc-label">${labels[group].name}</div><div class="pc-value">${val}%</div><div class="pc-sub">${labels[group][key]}</div></div>`;
          }
        }
      }
    }
  }
  
  content.innerHTML = html;
}

function clearGroup(group) {
  document.getElementById(group + 'Total').value = '';
  config[group].total = 0;
  updateTotal(group);
}

function clearSub(group, key) {
  if (config[group].auto) {
    // For auto groups like impact, clear the total
    clearGroup(group);
    return;
  }
  
  const inputId = inputMap[`${group}-${key}`];
  const itemId = itemMap[`${group}-${key}`];
  
  if (inputId) document.getElementById(inputId).value = '';
  if (itemId) document.getElementById(itemId).classList.remove('has-value');
  config[group].subs[key] = 0;
  
  if (group === 'runs') updateImpactDistribution();
  
  updateSubtotal(group);
  updateGrandTotal();
  updateTags();
  updatePreview();
}

function resetWeights() {
  for (const [group, cfg] of Object.entries(config)) {
    document.getElementById(group + 'Total').value = '';
    cfg.total = 0;
    
    cfg.subKeys.forEach(key => {
      cfg.subs[key] = 0;
      const inputId = inputMap[`${group}-${key}`];
      const itemId = itemMap[`${group}-${key}`];
      if (inputId) document.getElementById(inputId).value = '';
      if (itemId) {
        document.getElementById(itemId).classList.remove('has-value');
        document.getElementById(itemId).classList.add('disabled');
      }
    });
    
    if (cfg.auto) {
      cfg.subKeys.forEach(key => {
        document.getElementById(group.replace('impact','impact') + key + 'Val').textContent = '0%';
      });
    }
    
    updateSubtotal(group);
  }
  
  // Fix impact display
  ['1','2','3','4'].forEach(key => {
    document.getElementById('impact' + key + 'Val').textContent = '0%';
  });
  
  updateGrandTotal();
  updateTags();
  updatePreview();
}

function applyWeights() {
  const grandTotal = Object.values(config).reduce((sum, cfg) => sum + cfg.total, 0);
  
  if (grandTotal !== 100) {
    alert('Category totals must sum to 100%. Currently at ' + grandTotal + '%');
    return;
  }
  
  // Check all subtotals match
  let valid = true;
  let errors = [];
  
  for (const [group, cfg] of Object.entries(config)) {
    if (cfg.total > 0 && cfg.subKeys.length > 0) {
      const subTotal = Object.values(cfg.subs).reduce((a, b) => a + b, 0);
      if (subTotal !== cfg.total) {
        valid = false;
        errors.push(`${labels[group].name}: sub-total ${subTotal}% ≠ category total ${cfg.total}%`);
      }
    }
  }
  
  if (!valid) {
    alert('Sub-totals must match category totals:\n\n' + errors.join('\n'));
    return;
  }
  
  console.log('Applied configuration:', config);
  alert('Weights applied successfully!\n\nConfiguration saved. Ready to run simulation.');
}

// Initialize
updateGrandTotal();

// Share functionality
function sharePage(){
  const shareUrl = window.location.href;
  
  const shareTitle = 'Test Cricket Simulation Weights';
  const shareText = 'Configure weights for different performance factors to run custom simulations';
  
  if(navigator.share && navigator.canShare && navigator.canShare({url: shareUrl})){
    navigator.share({
      title: shareTitle,
      text: shareText,
      url: shareUrl
    }).catch(err => {
      if(err.name !== 'AbortError'){
        fallbackShare(shareUrl);
      }
    });
  } else {
    fallbackShare(shareUrl);
  }
}

function fallbackShare(url){
  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(url).then(()=>{
      showCopiedFeedback();
    }).catch(()=>{
      showShareDialog(url);
    });
  } else {
    showShareDialog(url);
  }
}

function showCopiedFeedback(){
  const btn = document.querySelector('.share-btn');
  const originalHTML = btn.innerHTML;
  btn.innerHTML = '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px;stroke:currentColor;fill:none"><polyline points="20 6 9 17 4 12"></polyline></svg><span>Copied!</span>';
  btn.style.color = 'var(--green)';
  btn.style.borderColor = 'var(--green)';
  setTimeout(()=>{
    btn.innerHTML = originalHTML;
    btn.style.color = '';
    btn.style.borderColor = '';
  }, 2000);
}

function showShareDialog(url){
  prompt('Copy this URL to share:', url);
}
</script>
</body>
</html>
